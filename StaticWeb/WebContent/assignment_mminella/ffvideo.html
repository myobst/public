<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>&#161;&#161;webpage&#33;&#33;</title>
		<link href='http://fonts.googleapis.com/css?family=Share+Tech|Viga' rel='stylesheet' type='text/css'>
		<link href='css/base.css' rel='stylesheet' type='text/css'>
		<script type="text/javascript">
			document.addEventListener( 'DOMContentLoaded', onContentLoaded, false );
			function onContentLoaded( event ){
				//no legit media-querries for touch support, but this seems to work
				//note: decided to just use click event for fallback
				//var touchSupport = 'ontouchstart' in document.documentElement;
			}
			function onThumbDragStart( event ){
				event.dataTransfer.setData( "Text", JSON.stringify( getThumbDataset( event.target ) ) );
			} 
			//using click event as fallback for dragdrop support issues with "touch" enabled devices
			function onThumbClick( event ){
				loadVideo( getThumbDataset( event.target ) );
			}
			function getThumbDataset( thumb ){ 
				//dataset not working in IE11 so using getAttribute to manually create, probably a slicker way to do this
				return thumb.dataset ? thumb.dataset : { "mp4":thumb.getAttribute('data-mp4'), "webm":thumb.getAttribute('data-webm') };
			}
			function allowDrop( event ){
				event.preventDefault();
			}
			function onVideoDrop( event ){
				event.preventDefault();
				loadVideo( JSON.parse( event.dataTransfer.getData( "Text" ) ) );
			}
			function loadVideo( dataset ){
				source_mp4.src = dataset.mp4;
				source_webm.src = dataset.webm;  
				video.load();
				video.play();
			}
		</script>
	</head>
	<body>
		<nav>
			<h1>&#161;&#161;webpage&#33;&#33;</h1>
			<div id="mainNav">
				<ul id="mainMenu"> 
					<li><a href="#dndVideoPlayer">DnD Video Player</a></li>
					<li><a href="#ffmpegSettings">FFmpeg Settings</a></li>
					<li><a href="#footer">The Footer</a></li>
					<li><a id="close" href="#close">close</a></li>
				</ul>
				<a id="mainMenuIcon" href="#mainMenu"></a>
			</div>
		</nav>
		<section>
			<article id="dndVideoPlayer">
				<header>
					<h2>Drag and Drop Video Player (sort of...)</h2>
				</header>
				<p>Drag a thumbnail to the video player for playback (or just click the thumbnail).
Note that drag and drop does not work on touch devices, how this is rationalized is a beyond me. For touch enabled decives the thumbnails must be "clicked" so a click event handler is added as a fallback.
Each thumbnail stores the mp4 and webm urls (in the dataset) which will be passed to the video source elements.</p>
				<div id="videoPlayer">
	 				<ul id="videoNav">
						<li><img class="videoThumb" ondragstart="onThumbDragStart(event)" draggable="true" onclick="onThumbClick(event)" 
								data-mp4="content/Brazil_Ilusoes_Optical_illusion_Viral.mp4" data-webm="content/Brazil_Ilusoes_Optical_illusion_Viral.webm" src="content/Brazil_Ilusoes_Optical_illusion_Viral.jpg"/></li>
						<li><img class="videoThumb" ondragstart="onThumbDragStart(event)" draggable="true" onclick="onThumbClick(event)" 
								data-mp4="content/hd_other_sony_the_incredible_game.mp4" data-webm="content/hd_other_sony_the_incredible_game.webm" src="content/hd_other_sony_the_incredible_game.jpg"/></li>
						<li><img class="videoThumb" ondragstart="onThumbDragStart(event)" draggable="true" onclick="onThumbClick(event)" 
								data-mp4="content/lion.mp4" data-webm="content/lion.webm" data-mp4="mp4" data-webm="webm" src="content/lion.jpg"/></li>
						<li><img class="videoThumb" ondragstart="onThumbDragStart(event)" draggable="true" onclick="onThumbClick(event)" 
								data-mp4="content/O_Rewind_90_VF.mp4" data-webm="content/O_Rewind_90_VF.webm" src="content/O_Rewind_90_VF.jpg"/></li>
						<li><img class="videoThumb" ondragstart="onThumbDragStart(event)" draggable="true" onclick="onThumbClick(event)" 
								data-mp4="content/Olay_Warrior.mp4" data-webm="content/Olay_Warrior.webm" src="content/Olay_Warrior.jpg"/></li>
						<li><img class="videoThumb" ondragstart="onThumbDragStart(event)" draggable="true" onclick="onThumbClick(event)" 
								data-mp4="content/Brazil_Ilusoes_Optical_illusion_Viral.mp4" data-webm="content/Brazil_Ilusoes_Optical_illusion_Viral.webm" src="content/Brazil_Ilusoes_Optical_illusion_Viral.jpg"/></li>
						</ul>
					<video id="video" ondrop="onVideoDrop(event)" ondragover="allowDrop(event)" controls="controls">
						<source id="source_mp4" type="video/mp4"/>
						<source id="source_webm" type="video/webm"/>
		 			</video>
	 			</div>
			</article>
		</section>
		<section id="ffmpegSettings">
			<article>
				<header>
					<h2>Ffmpeg Settings</h2>
				</header>
				<ol class="codeView">
					<li></li><li>::MP4</li>
					<li>ffmpeg -i "[INPUT FILE]" -pass 1 -vf "yadif=0:-1:1, hqdn3d, unsharp, scale=min(trunc((oh*dar+1)/2)*2\, 640):min(trunc((640/dar+1)/2)*2\, 360), setsar=1" -f mp4 -vcodec libx264 -pix_fmt yuv420p -vb 600k -preset slow -vprofile high -an -y NUL</li>
					<li>ffmpeg -i "[INPUT FILE]" -pass 2 -vf "yadif=0:-1:1, hqdn3d, unsharp, scale=min(trunc((oh*dar+1)/2)*2\, 640):min(trunc((640/dar+1)/2)*2\, 360), setsar=1" -f mp4 -vcodec libx264 -pix_fmt yuv420p -vb 600k -preset slow -vprofile high -ac 2 -ar 32k -ab 80k -movflags faststart "[OUTPUT FILE].mp4"</li>
					<li></li><li>::WebM</li>
					<li>ffmpeg -i "[INPUT FILE]" -pass 1 -vf "yadif=0:-1:1, hqdn3d, unsharp, scale=min(trunc((oh*dar+1)/2)*2\, 640):min(trunc((640/dar+1)/2)*2\, 360), setsar=1" -f webm -vcodec libvpx -pix_fmt yuv420p -vb 600k -quality good -an -y NUL</li>
					<li>ffmpeg -i "[INPUT FILE]" -pass 2 -vf "yadif=0:-1:1, hqdn3d, unsharp, scale=min(trunc((oh*dar+1)/2)*2\, 640):min(trunc((640/dar+1)/2)*2\, 360), setsar=1" -f webm -vcodec libvpx -pix_fmt yuv420p -vb 600k -quality good -ac 2 -ar 32k -ab 80k "[OUTPUT FILE].webm"</li>
					<li></li><li>::Square Thumb</li>
					<li>ffmpeg -i "[INPUT FILE]" -ss 3 -vframes 1 -vf "yadif=0:-1:1, hqdn3d, unsharp, scale=trunc(oh*dar)\:120, setsar=1, crop=120:120" -f image2 "[OUTPUT FILE].jpg"</li>
				</ol>
			</article>
		</section>
		<footer id="footer">&copy; Footy 2013</footer>
	</body>
</html>